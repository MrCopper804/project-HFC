<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HFC - Falling Letter PRO</title>
    <style>
        :root {
            --bg: #000000;
            --neon: #00f2ff;
            --danger: #ff0055;
            --key-bg: #1a1a1a;
        }

        body {
            font-family: 'Segoe UI', sans-serif;
            background: var(--bg);
            color: white; margin: 0; padding: 0;
            display: flex; flex-direction: column;
            height: 100vh; overflow: hidden;
            user-select: none;
        }

        .game-header {
            padding: 12px;
            display: flex; justify-content: space-between;
            background: rgba(0, 242, 255, 0.05);
            border-bottom: 1px solid rgba(0, 242, 255, 0.1);
        }

        .stat-box { text-align: center; }
        .label { font-size: 8px; color: var(--neon); letter-spacing: 1px; display: block; }
        .value { font-size: 15px; font-weight: 900; }

        #gameArea {
            position: relative;
            flex: 1;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            background: radial-gradient(circle at center, #0a192f 0%, #000 100%);
        }

        .letter-card {
            position: absolute;
            top: -60px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255,255,255,0.05);
            border: 2px solid var(--neon);
            width: 55px; height: 55px;
            border-radius: 12px;
            display: flex; justify-content: center; align-items: center;
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
            backdrop-filter: blur(5px);
        }

        #hfcSymbol { font-size: 30px; font-weight: bold; color: #fff; text-shadow: 0 0 8px var(--neon); }

        .laser-line {
            position: absolute;
            bottom: 5px;
            width: 100%; height: 3px;
            background: var(--danger);
            box-shadow: 0 0 12px var(--danger);
        }

        /* --- REAL QWERTY KEYBOARD DESIGN --- */
        .keyboard-area {
            background: #0d0d0d;
            padding: 10px 5px 25px 5px;
            border-top: 1px solid #333;
        }

        .kb-row {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-bottom: 6px;
        }

        .key {
            background: var(--key-bg);
            color: white;
            flex: 1;
            max-width: 35px;
            height: 45px;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 6px;
            font-size: 16px;
            font-weight: bold;
            box-shadow: 0 3px 0 #000;
            transition: 0.1s;
            cursor: pointer;
        }

        .key:active {
            transform: translateY(3px);
            box-shadow: 0 0 0 #000;
            background: var(--neon);
            color: black;
        }

        /* Spacing for rows to look real */
        .row-2 { padding: 0 5%; }
        .row-3 { padding: 0 10%; }

        .exit-link {
            display: block; text-align: center; color: #444;
            text-decoration: none; font-size: 11px; margin-top: 8px;
        }
    </style>
</head>
<body id="mainBody">

    <div class="game-header">
        <div class="stat-box">
            <span class="label">MISSION XP</span>
            <span class="value" id="gameScore">0 / 10</span>
        </div>
        <div class="stat-box">
            <span class="label">LOBBY PTS</span>
            <span class="value" id="totalPts">0</span>
        </div>
    </div>

    <div id="gameArea">
        <div class="letter-card" id="fallingCard"><span id="hfcSymbol">?</span></div>
        <div class="laser-line"></div>
    </div>

    <div class="keyboard-area">
        <div class="kb-row" id="row1"></div>
        <div class="kb-row row-2" id="row2"></div>
        <div class="kb-row row-3" id="row3"></div>
        <a href="lobby.html" class="exit-link">EXIT MISSION</a>
    </div>

<script>
    const hfcMapping = {'A': '+', 'B': '[]', 'C': '©', 'D': '÷', 'E': '=', 'F': '_', 'G': '>', 'H': '|', 'I': '!', 'J': '#', 'K': ':', 'L': '<', 'M': '*', 'N': '°', 'O': '()', 'P': '¶', 'Q': '?', 'R': '®', 'S': '$', 'T': '™', 'U': "'", 'V': '^', 'W': '&', 'X': '`', 'Y': '~', 'Z': '℅'};
    
    const qwerty = [
        ["Q","W","E","R","T","Y","U","I","O","P"],
        ["A","S","D","F","G","H","J","K","L"],
        ["Z","X","C","V","B","N","M"]
    ];

    let currentLetter = "";
    let missionScore = 0;
    let posY = -60;
    let speed = 2.0;
    let gameRunning = true;
    let totalScore = parseInt(localStorage.getItem('hfcScore')) || 0;

    document.getElementById('totalPts').innerText = totalScore;

    // Build QWERTY Keyboard
    qwerty.forEach((row, index) => {
        const rowDiv = document.getElementById(`row${index + 1}`);
        row.forEach(key => {
            const btn = document.createElement('div');
            btn.className = 'key';
            btn.innerText = key;
            btn.onclick = () => handleInput(key);
            rowDiv.appendChild(btn);
        });
    });

    function handleInput(letter) {
        if(!gameRunning) return;
        if(letter === currentLetter) {
            missionScore++;
            if(missionScore >= 10) {
                totalScore += 2;
                localStorage.setItem('hfcScore', totalScore);
                document.getElementById('totalPts').innerText = totalScore;
                missionScore = 0;
                speed += 0.2;
            }
            document.getElementById('gameScore').innerText = missionScore + " / 10";
            spawn();
        }
    }

    function spawn() {
        const letters = Object.keys(hfcMapping);
        currentLetter = letters[Math.floor(Math.random() * letters.length)];
        document.getElementById('hfcSymbol').innerText = hfcMapping[currentLetter];
        posY = -60;
        let areaWidth = document.getElementById('gameArea').offsetWidth;
        let randomX = Math.floor(Math.random() * (areaWidth - 100)) + 50;
        document.getElementById('fallingCard').style.left = randomX + "px";
    }

    function loop() {
        if(!gameRunning) return;
        posY += speed;
        const card = document.getElementById('fallingCard');
        card.style.top = posY + "px";
        let limit = document.getElementById('gameArea').offsetHeight - 20;
        if (posY >= limit) {
            gameRunning = false;
            alert("LASER BREACHED! Final Score: " + missionScore);
            location.reload();
        }
        requestAnimationFrame(loop);
    }

    spawn();
    loop();
</script>
</body>
</html>
