<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HFC Academy - Mega Mission 30</title>
    <style>
        :root { 
            --neon: #64ffda; --bg: #000; --gold: #ffd700; --danger: #ff4d4d; --glass: rgba(255, 255, 255, 0.05);
        }
        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg); 
            background-image: radial-gradient(circle at top, #112240 0%, #000 90%);
            color: white; margin: 0; padding: 15px; text-align: center; min-height: 100vh;
        }
        .mission-container {
            max-width: 550px; margin: 10px auto; background: var(--glass);
            border: 2px solid var(--gold); border-radius: 25px; padding: 25px;
            backdrop-filter: blur(15px); box-sizing: border-box;
        }
        .cipher-display {
            background: rgba(0,0,0,0.8); padding: 20px; border-radius: 15px;
            color: var(--neon); font-size: 16px; letter-spacing: 1.5px;
            line-height: 1.8; border: 1px dashed var(--neon); margin: 15px 0;
            word-break: break-all; text-align: left; height: 180px; overflow-y: auto;
        }
        textarea {
            width: 100%; height: 140px; background: rgba(255,255,255,0.05);
            border: 1px solid #333; border-radius: 15px; color: #fff;
            padding: 12px; outline: none; box-sizing: border-box; font-size: 13px; line-height: 1.5;
        }
        .btn-main {
            background: var(--gold); color: #000; border: none; padding: 18px;
            border-radius: 15px; font-weight: 900; width: 100%; cursor: pointer;
            text-transform: uppercase; margin-top: 10px;
        }
        .lock-screen { color: var(--danger); font-weight: 800; padding: 50px 0; letter-spacing: 1px; line-height: 1.5; }
    </style>
</head>
<body>

    <h1 style="color:var(--gold); letter-spacing: 5px; margin: 10px 0 0 0;">MEGA MISSION</h1>
    <p style="font-size: 10px; color: var(--neon); letter-spacing: 2px;">30-WORD DECRYPTION CHALLENGE</p>

    <div class="mission-container">
        <div id="lockUI" style="display:none;" class="lock-screen">⚠️ SECURITY LOCKOUT<br>SYSTEM GRANTS ACCESS EVERY 7 DAYS</div>

        <div id="entryUI" style="display:none;">
            <p style="font-size: 12px; margin-bottom: 20px; color: #ccc;">FEE: 1000 XP | REWARD: 500 COINS<br>Authorized attempts per cycle: 2</p>
            <button class="btn-main" onclick="startMegaMission()">INITIALIZE MISSION (-1000 XP)</button>
        </div>

        <div id="missionUI" style="display:none;">
            <div id="attemptStatus" style="color: var(--danger); font-weight: bold; margin-bottom: 10px; font-size: 11px;">ATTEMPT: 1 / 2</div>
            <div class="cipher-display" id="cipherText">DECRYPTING ARCHIVES...</div>
            <textarea id="userInput" placeholder="Type the 30-word English translation here..."></textarea>
            <button class="btn-main" onclick="verifyMission()">VERIFY DATA</button>
        </div>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBIT9JgQ8t044EbgeGSGWNfh-CgNrWajN8",
        authDomain: "hfc-academy.firebaseapp.com",
        projectId: "hfc-academy",
        storageBucket: "hfc-academy.firebasestorage.app",
        messagingSenderId: "84006497196",
        appId: "1:84006497196:web:be0d33ae2db19dd77ae809"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // --- 30-WORD RANDOM PARAGRAPH BANK ---
    const PARAGRAPHS = [
        "The elite agents of the academy must learn to decode complex symbols quickly to secure the secret network from unauthorized access and protect the private data of all members involved",
        "Practice your skills every day to master the ancient art of cryptography because only the most dedicated students will earn the rank of legend within this highly secure digital environment",
        "A true master of hidden messages can identify patterns in any stream of data without using external tools and will always maintain the highest level of security for the system",
        "To earn five hundred coins you must translate this entire thirty word paragraph accurately on your first or second try or you will have to wait another seven full days",
        "Security is the most important part of our mission here so never share your private login details or account information with anyone even if they claim to be the admin",
        "The digital world is full of hidden dangers and only those who can master the art of secret writing will be able to survive the upcoming challenges in the academy",
        "Every single symbol you see on the screen represents a letter in the English alphabet so you must use your training to decipher the message before the time runs out",
        "Your mission as an operative is to maintain the integrity of the database by ensuring that all incoming data streams are correctly translated and verified against our highly secure protocols",
        "Learning to read these complex characters requires patience and many hours of dedicated study but the rewards for reaching the highest rank are well worth the effort in the end",
        "Hidden deep within the code of this website is a secret message that only a few talented agents will ever be able to find and translate using their special skills",
        "The academy was built to protect the freedom of information while ensuring that only authorized personnel have access to the most sensitive parts of our global digital communication network infrastructure",
        "Always be on the lookout for suspicious activity within the tunnel and report any errors in the decryption process to the master administrator so that we can fix the system",
        "A thousand experience points is a large amount to pay for entry so you must be absolutely certain of your decoding abilities before you attempt this difficult weekly mega mission",
        "Advanced cryptography is not just about changing letters but also about understanding the logic behind the patterns that govern how information is stored and transmitted across the vast internet today",
        "The legend rank is reserved for those who have proven their worth through countless hours of hard work and have shown a deep understanding of the core principles of decryption",
        "Do not be discouraged if you fail on your first attempt because even the best agents started as simple recruits before they worked their way up to the top level",
        "A secure future starts with a well trained mind so focus on your studies and never stop learning new ways to protect yourself and your data from those who wish",
        "The symbol for the letter A is a plus sign and the symbol for B is a square bracket but you must memorize the entire chart to be effective here",
        "Every week a new challenge is presented to the agents of this school to test their mental strength and their ability to work under extreme pressure during a high stakes",
        "The rewards for success are high but the cost of failure is losing your entry fee and being locked out of the system for an entire week of training time",
        "Coding and decoding are the two sides of the same coin and a professional agent must be proficient in both areas to successfully complete all the missions assigned to them",
        "The speed of the tunnel will increase as you progress further into the game so you must develop fast reflexes and a sharp eye for detail to avoid crashing now",
        "This thirty word paragraph is designed to test your focus and your ability to correctly identify every single character without making even a small mistake in your final written answer",
        "Information is power in the modern age and those who can control the flow of data will be the ones who lead the world into a new era of security",
        "The master administrator is watching your progress closely and will reward those who show exceptional talent in the field of secret communication and digital security within our elite private academy"
    ];

    
    let selectedText = "";
    let currentAgent = null;
    let tries = 2;

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            currentAgent = user;
            const snap = await getDoc(doc(db, "users", user.uid));
            const data = snap.data();
            const lastRun = data.lastWeeklyCrypt || 0;
            const oneWeek = 7 * 24 * 60 * 60 * 1000;

            if (Date.now() - lastRun < oneWeek) {
                document.getElementById('lockUI').style.display = "block";
            } else {
                document.getElementById('entryUI').style.display = "block";
            }
        } else { window.location.href = "auth.html"; }
    });

    window.startMegaMission = async () => {
        const userRef = doc(db, "users", currentAgent.uid);
        const snap = await getDoc(userRef);
        if ((snap.data().score || 0) < 1000) return alert("Insufficient XP! 1000 XP Required.");

        await updateDoc(userRef, { score: increment(-1000) });
        selectedText = PARAGRAPHS[Math.floor(Math.random() * PARAGRAPHS.length)];
        
        document.getElementById('cipherText').innerText = encodeHFC(selectedText);
        document.getElementById('entryUI').style.display = "none";
        document.getElementById('missionUI').style.display = "block";
    };

    window.verifyMission = async () => {
        const input = document.getElementById('userInput').value.trim().toLowerCase();
        const userRef = doc(db, "users", currentAgent.uid);

        // Remove extra spaces for better validation
        const cleanInput = input.replace(/\s+/g, ' ');
        const cleanTarget = selectedText.toLowerCase().replace(/\s+/g, ' ');

        if (cleanInput === cleanTarget) {
            await updateDoc(userRef, { coins: increment(500), lastWeeklyCrypt: Date.now() });
            alert("MISSION SUCCESS: 500 COINS GRANTED.");
            location.reload();
        } else {
            tries--;
            if (tries <= 0) {
                await updateDoc(userRef, { lastWeeklyCrypt: Date.now() });
                alert("CRITICAL ERROR: Access revoked. System locked for 7 days.");
                location.reload();
            } else {
                document.getElementById('attemptStatus').innerText = "ATTEMPT: 2 / 2 (WARNING: FINAL CHANCE)";
                alert("DECRYPTION FAILED: The data provided does not match the encrypted archives.");
            }
        }
    };

    function encodeHFC(text) {
        const map = { 'a':'+','b':'[]','c':'©','d':'÷','e':'=','f':'_','g':'>','h':'|','i':'!','j':'#','k':':','l':'<','m':'*','n':'°','o':'()','p':'¶','q':'?','r':'®','s':'$','t':'™','u':"'",'v':'^','w':'&','x':'`','y':'~','z':'℅',' ': '  ' };
        return text.toLowerCase().split('').map(c => map[c] || c).join('');
    }
</script>
</body>
</html>
