<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HFC - The Impossible Vault</title>
    <style>
        :root { --neon: #64ffda; --bg: #030712; --gold: #ffd700; --danger: #ff4d4d; }
        body { 
            font-family: 'Segoe UI', sans-serif; background: var(--bg); color: white; 
            margin: 0; padding: 20px; text-align: center;
            background-image: radial-gradient(circle at top, #112240 0%, #030712 90%);
        }
        .header { display: flex; justify-content: space-between; font-size: 11px; color: var(--neon); margin-bottom: 30px; border: 1px solid #112240; padding: 12px; border-radius: 12px; background: rgba(0,0,0,0.5); }
        
        .vault-ui { background: rgba(255,255,255,0.02); border: 1px solid #222; padding: 30px; border-radius: 20px; box-shadow: inset 0 0 20px #000; }
        
        .symbol-box { font-size: 32px; letter-spacing: 8px; margin: 25px 0; color: var(--gold); min-height: 50px; font-weight: bold; text-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }

        .timer-container { width: 100%; height: 8px; background: #000; border-radius: 10px; margin-bottom: 25px; border: 1px solid #222; overflow: hidden; }
        #timerBar { width: 100%; height: 100%; background: var(--danger); box-shadow: 0 0 10px var(--danger); }

        input { width: 100%; padding: 18px; background: #050505; border: 1px solid #333; color: white; border-radius: 12px; text-align: center; font-size: 22px; outline: none; box-sizing: border-box; text-transform: uppercase; }
        input:focus { border-color: var(--danger); box-shadow: 0 0 15px rgba(255, 77, 77, 0.2); }
        
        .btn-start { padding: 20px 45px; background: var(--danger); color: #fff; border: none; border-radius: 15px; font-weight: 900; cursor: pointer; text-transform: uppercase; letter-spacing: 2px; }
    </style>
</head>
<body>

    <div class="header">
        <span>AGENT: <b id="userRank">---</b></span>
        <span>VAULT: <b id="userCoins">0</b></span>
    </div>

    <div id="startScreen">
        <h1 style="color:var(--danger); letter-spacing: 8px; margin-bottom: 10px;">IMPOSSIBLE VAULT</h1>
        <p style="font-size: 12px; color: #555; margin-bottom: 30px;">FEE: 10 COINS | REWARD: 25 COINS<br>SYSTEM: REVERSED RANK DIFFICULTY</p>
        <button class="btn-start" onclick="beginMission()">ENTER THE VOID</button>
    </div>

    <div id="gameScreen" style="display: none;">
        <div class="timer-container"><div id="timerBar"></div></div>
        <div class="vault-ui">
            <div id="diffLabel" style="font-size: 10px; color: var(--danger); margin-bottom: 10px; font-weight: bold;"></div>
            <div class="symbol-box" id="symbolDisplay"></div>
            <input type="text" id="userInput" placeholder="DECRYPT FAST" autocomplete="off">
        </div>
        <p style="font-size: 9px; color: #444; margin-top: 20px;">FAILING THIS MISSION WILL DEDUCT YOUR STAKE IMMEDIATELY.</p>
    </div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, onSnapshot, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = { /* Your Config */ };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    let userData = {};
    const hfcChart = { 'A': '+', 'B': '[]', 'C': '©', 'D': '÷', 'E': '=', 'F': '_', 'G': '>', 'H': '|', 'I': '!', 'J': '}', 'K': '{', 'L': '(', 'M': ')', 'N': '^', 'O': '*', 'P': '&', 'Q': '%', 'R': '$', 'S': '#', 'T': '@', 'U': '?', 'V': '/', 'W': '\\', 'X': '×', 'Y': '¥', 'Z': '§' };
    
    // Reversed Word Bank: Recruit gets the longest words
    const reversedWords = {
        recruit: ["ACADEMY", "LEGENDARY", "DECRYPTED", "SECURITY", "PROTOCOL"],
        agent: ["MASTER", "VORTEX", "MISSION", "DANGER"],
        operative: ["BRAIN", "LIGHT", "STORM", "WOLF"],
        specialist: ["FIRE", "GOLD", "DARK", "BANK"],
        commander: ["CAT", "DOG", "SKY", "BOX"],
        legend: ["ACE", "TOP", "KEY", "VIP"]
    };

    let target = "";
    let gameClock;

    onAuthStateChanged(auth, u => {
        if(u) {
            onSnapshot(doc(db, "users", u.uid), s => {
                userData = s.data();
                document.getElementById('userRank').innerText = userData.rank.toUpperCase();
                document.getElementById('userCoins').innerText = userData.coins;
            });
        }
    });

    window.beginMission = async () => {
        if(userData.coins < 10) return alert("VAULT ACCESS DENIED: INSUFFICIENT COINS");
        await updateDoc(doc(db, "users", auth.currentUser.uid), { coins: increment(-10) });
        
        document.getElementById('startScreen').style.display = 'none';
        document.getElementById('gameScreen').style.display = 'block';
        document.getElementById('userInput').focus();
        loadChallenge();
    };

    function loadChallenge() {
        const rank = userData.rank || "recruit";
        const words = reversedWords[rank] || reversedWords.recruit;
        target = words[Math.floor(Math.random() * words.length)];
        
        let syms = "";
        for(let l of target) { syms += hfcChart[l] || "?"; }
        document.getElementById('symbolDisplay').innerText = syms;

        // Reversed Difficulty Logic
        let time = 6000; // Legend gets 6s
        if(rank === "commander") time = 5000;
        if(rank === "specialist") time = 4000;
        if(rank === "operative") time = 3000;
        if(rank === "agent") time = 2500;
        if(rank === "recruit") time = 2000; // Recruit gets only 2s!

        document.getElementById('diffLabel').innerText = `CRITICAL THREAT: ${rank.toUpperCase()} - ${time/1000}s LIMIT`;
        
        let start = Date.now();
        gameClock = setInterval(() => {
            let left = 100 - ((Date.now() - start) / time * 100);
            document.getElementById('timerBar').style.width = left + "%";
            if(left <= 0) { clearInterval(gameClock); end("MISSION FAILED: SYSTEM LOCKED"); }
        }, 20);
    }

    document.getElementById('userInput').oninput = function() {
        if(this.value.toUpperCase() === target) {
            clearInterval(gameClock);
            win();
        }
    };

    async function win() {
        alert("VAULT BREACHED! +25 COINS ADDED");
        await updateDoc(doc(db, "users", auth.currentUser.uid), { coins: increment(25) });
        location.reload();
    }

    function end(m) { alert(m); location.reload(); }
</script>
</body>
</html>
