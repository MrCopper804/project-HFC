<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HFC - Global Leaderboard</title>
    <style>
        :root { --bg: #000; --neon: #64ffda; --gold: #ffd700; --glass: rgba(255, 255, 255, 0.05); --panel: #0a192f; }
        body { 
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif; 
            margin: 0; padding: 15px; text-align: center;
            background-image: radial-gradient(circle at top, #112240 0%, #000 90%);
            min-height: 100vh;
        }

        .title { color: var(--neon); letter-spacing: 5px; font-weight: 900; margin: 20px 0; text-transform: uppercase; font-size: 22px; }
        
        /* Tabs Styling */
        .leader-tabs { display: flex; gap: 8px; margin: 20px auto; max-width: 450px; }
        .tab { 
            flex: 1; padding: 12px; background: var(--glass); border: 1px solid #333; 
            border-radius: 12px; cursor: pointer; font-size: 11px; font-weight: 900; 
            color: #888; transition: 0.3s; text-transform: uppercase;
        }
        .tab.active { border-color: var(--neon); color: var(--neon); background: rgba(100, 255, 218, 0.1); }

        .leader-container {
            max-width: 450px; margin: 0 auto; background: rgba(10, 25, 47, 0.6);
            border: 1px solid rgba(100, 255, 218, 0.1); border-radius: 20px;
            padding: 10px; backdrop-filter: blur(15px); box-shadow: 0 20px 50px rgba(0,0,0,0.5);
        }
        
        .entry {
            display: flex; align-items: center; padding: 12px 15px;
            border-bottom: 1px solid rgba(255,255,255,0.03);
            animation: fadeIn 0.4s ease forwards; opacity: 0;
        }
        @keyframes fadeIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        .rank-num { width: 35px; font-weight: 900; font-size: 16px; color: #555; }
        .agent-info { flex: 1; text-align: left; margin-left: 10px; }
        .agent-name { font-size: 13px; font-weight: 700; color: #fff; text-transform: uppercase; display: block; }
        .agent-rank { font-size: 9px; color: var(--neon); letter-spacing: 1px; text-transform: uppercase; opacity: 0.8; }
        
        .agent-value { 
            font-weight: 900; font-size: 14px; color: #fff; 
            background: rgba(255,255,255,0.03); padding: 6px 12px; 
            border-radius: 10px; border: 1px solid rgba(255,255,255,0.1); 
        }

        /* Top 3 Medals */
        .entry:nth-child(1) .rank-num { color: var(--gold); font-size: 22px; text-shadow: 0 0 10px var(--gold); }
        .entry:nth-child(2) .rank-num { color: #e5e4e2; font-size: 20px; }
        .entry:nth-child(3) .rank-num { color: #cd7f32; font-size: 18px; }
        
        .entry:nth-child(1) { background: rgba(255, 215, 0, 0.03); border-radius: 15px; border: 1px solid rgba(255, 215, 0, 0.1); margin-bottom: 5px; }

        .back-btn {
            display: inline-block; margin-top: 30px; color: var(--neon);
            text-decoration: none; font-size: 11px; font-weight: bold;
            border: 1px solid var(--neon); padding: 12px 30px; border-radius: 12px;
            text-transform: uppercase; letter-spacing: 2px; transition: 0.3s;
        }
        .back-btn:hover { background: var(--neon); color: #000; box-shadow: 0 0 20px var(--neon); }
    </style>
</head>
<body>

    <h2 class="title">Elite Rankings</h2>

    <div class="leader-tabs">
        <div class="tab active" id="tabXP" onclick="switchLeaderboard('score')">XP Leaders</div>
        <div class="tab" id="tabCoins" onclick="switchLeaderboard('coins')">Coin Lords</div>
    </div>

    <div class="leader-container" id="leaderboardList">
        <p style="color: #444; padding: 40px; font-size: 12px;">FETCHING AGENT DATA...</p>
    </div>

    <a href="lobby.html" class="back-btn">Return to Base</a>

    

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, query, orderBy, limit, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBIT9JgQ8t044EbgeGSGWNfh-CgNrWajN8",
            authDomain: "hfc-academy.firebaseapp.com",
            projectId: "hfc-academy",
            storageBucket: "hfc-academy.firebasestorage.app",
            messagingSenderId: "84006497196",
            appId: "1:84006497196:web:be0d33ae2db19dd77ae809"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        let currentSort = 'score'; // Default sorting by XP (score)
        let unsubscribe = null;

        window.switchLeaderboard = (type) => {
            currentSort = type;
            
            // UI Toggle
            document.getElementById('tabXP').classList.toggle('active', type === 'score');
            document.getElementById('tabCoins').classList.toggle('active', type === 'coins');
            
            loadData();
        };

        function loadData() {
            if (unsubscribe) unsubscribe(); // Purana listener band karo

            const leaderRef = collection(db, "users");
            const q = query(leaderRef, orderBy(currentSort, "desc"), limit(15));

            unsubscribe = onSnapshot(q, (snapshot) => {
                const listDiv = document.getElementById('leaderboardList');
                listDiv.innerHTML = "";

                let rank = 1;
                snapshot.forEach((doc) => {
                    const data = doc.data();
                    const name = data.username || (data.email ? data.email.split('@')[0] : "RECRUIT");
                    const rankName = (data.rank || "recruit").toUpperCase();
                    const value = currentSort === 'score' ? (data.score || 0) + " XP" : (data.coins || 0) + " COINS";
                    
                    let medal = rank === 1 ? "ðŸ¥‡" : rank === 2 ? "ðŸ¥ˆ" : rank === 3 ? "ðŸ¥‰" : `#${rank}`;

                    listDiv.innerHTML += `
                        <div class="entry" style="animation-delay: ${rank * 0.05}s">
                            <div class="rank-num">${medal}</div>
                            <div class="agent-info">
                                <span class="agent-name">${name}</span>
                                <span class="agent-rank">${rankName}</span>
                            </div>
                            <div class="agent-value" style="color: ${currentSort === 'coins' ? 'var(--gold)' : 'var(--neon)'}">${value}</div>
                        </div>
                    `;
                    rank++;
                });

                if (snapshot.empty) {
                    listDiv.innerHTML = "<p style='padding:40px; color:#444;'>No active agents found.</p>";
                }
            });
        }

        // Initial Load
        loadData();
    </script>
</body>
</html>
