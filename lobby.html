<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HFC Academy - Mission Lobby</title>
    <style>
        :root { --bg: #000; --neon: #64ffda; --gold: #ffd700; --admin: #ff0055; }
        body { background: var(--bg); color: #ccd6f6; font-family: sans-serif; margin: 0; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
        .header { background: rgba(10,15,26,0.95); padding: 10px 15px; border-bottom: 1px solid rgba(100,255,218,0.1); display: flex; align-items: center; height: 65px; box-sizing: border-box; }
        .user-stats { flex-grow: 1; margin: 0 12px; }
        .rank-text { font-weight: 900; font-size: 11px; color: var(--neon); text-transform: uppercase; }
        .currency-row { font-size: 10px; display: flex; gap: 10px; font-weight: bold; margin-top: 3px; }
        .grid { flex-grow: 1; display: grid; grid-template-columns: 1fr 1fr; gap: 12px; padding: 20px; max-width: 400px; margin: auto; width: 100%; box-sizing: border-box; }
        .card { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 15px; display: flex; flex-direction: column; justify-content: center; align-items: center; text-decoration: none; color: #fff; aspect-ratio: 1/0.9; }
        .card span { font-size: 10px; margin-top: 8px; font-weight: bold; letter-spacing: 1px; }
        .menu { position: fixed; top: 65px; right: 15px; background: #0d1117; border: 1px solid #30363d; border-radius: 10px; width: 180px; display: none; z-index: 1000; }
        .menu.active { display: block; }
        .menu-item { color: #fff; padding: 12px; font-size: 12px; font-weight: bold; cursor: pointer; display: block; text-decoration: none; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

    <div class="header">
        <div style="font-size: 20px;">üè†</div>
        <div class="user-stats">
            <div class="rank-text" id="displayRank">LOADING...</div>
            <div class="currency-row">
                <span>XP: <span id="displayXP" style="color:white">0</span></span>
                <span>COINS: <span id="displayCoins" style="color:var(--gold)">0</span></span>
            </div>
        </div>
        <div id="menuToggle" style="cursor:pointer; font-size: 20px;">‚öôÔ∏è</div>
    </div>

    <div class="menu" id="mainMenu">
        <a href="profile.html" class="menu-item">üë§ PROFILE</a>
        <a href="leaderboard.html" class="menu-item">üèÜ LEADERBOARD</a>
        <div class="menu-item" id="logoutBtn" style="color:#ff4d4d">üö™ LOGOUT</div>
    </div>

    <div class="grid">
        <a href="game1.html" class="card">‚å®Ô∏è<span>DECODE</span></a>
        <a href="game2.html" class="card">üß©<span>QUIZ</span></a>
        <a href="game3.html" class="card">üîé<span>MATCH</span></a>
        <a href="game5.html" class="card">üß†<span>RECALL</span></a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getFirestore, doc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBIT9JgQ8t044EbgeGSGWNfh-CgNrWajN8",
            authDomain: "hfc-academy.firebaseapp.com",
            projectId: "hfc-academy",
            storageBucket: "hfc-academy.firebasestorage.app",
            messagingSenderId: "84006497196",
            appId: "1:84006497196:web:be0d33ae2db19dd77ae809"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI Controls
        const menu = document.getElementById('mainMenu');
        document.getElementById('menuToggle').onclick = (e) => { e.stopPropagation(); menu.classList.toggle('active'); };
        document.onclick = () => menu.classList.remove('active');
        document.getElementById('logoutBtn').onclick = () => signOut(auth);

        // REAL-TIME SYNC LOGIC
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log("User Logged In:", user.uid);
                
                // onSnapshot real-time update karta hai jab bhi database change ho
                onSnapshot(doc(db, "users", user.uid), (snap) => {
                    if (snap.exists()) {
                        const data = snap.data();
                        console.log("Live Data Received:", data);
                        
                        document.getElementById('displayRank').innerText = (data.rank || "recruit").toUpperCase();
                        document.getElementById('displayXP').innerText = data.score || 0;
                        document.getElementById('displayCoins').innerText = data.coins || 0;

                        // Admin Check
                        if (data.role === "admin" && !document.getElementById('adminLink')) {
                            const a = document.createElement('a');
                            a.href = "admin.html";
                            a.id = "adminLink";
                            a.className = "menu-item";
                            a.style.color = "#ff0055";
                            a.innerText = "üõ°Ô∏è ADMIN PANEL";
                            menu.prepend(a);
                        }
                    } else {
                        console.error("No document found for this user in Firestore!");
                        document.getElementById('displayRank').innerText = "DATA ERROR";
                    }
                }, (error) => {
                    console.error("Firestore Sync Error:", error);
                    alert("Database Sync Failed. Check Rules!");
                });

            } else {
                window.location.href = "auth.html";
            }
        });
    </script>
</body>
</html>
