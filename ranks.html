<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>HFC - Rank Store</title>
    <style>
        :root { --bg: #000; --neon: #64ffda; --gold: #ffd700; --glass: rgba(255,255,255,0.05); }
        body { 
            background: var(--bg); color: white; font-family: 'Segoe UI', sans-serif;
            margin: 0; padding: 20px; background-image: radial-gradient(circle at top, #112240 0%, #000 80%);
        }
        .header { text-align: center; margin-bottom: 30px; }
        .coin-display { 
            background: var(--gold); color: #000; padding: 5px 15px; 
            border-radius: 20px; font-weight: bold; font-size: 14px;
        }
        .rank-grid { display: flex; flex-direction: column; gap: 15px; max-width: 400px; margin: 0 auto; }
        .rank-card {
            background: var(--glass); border: 1px solid rgba(255,255,255,0.1);
            padding: 20px; border-radius: 20px; display: flex; justify-content: space-between;
            align-items: center; backdrop-filter: blur(10px); transition: 0.3s;
        }
        .rank-info { display: flex; flex-direction: column; }
        .rank-name { font-weight: 900; letter-spacing: 1px; color: var(--neon); }
        .rank-price { font-size: 12px; color: var(--gold); margin-top: 5px; font-weight: bold; }
        .buy-btn {
            background: white; color: black; border: none; padding: 10px 20px;
            border-radius: 10px; font-weight: bold; cursor: pointer; transition: 0.2s;
        }
        .buy-btn:disabled { background: #333; color: #777; cursor: not-allowed; }
        .owned { background: var(--neon); color: #000; }
        
        .back-link { display: block; text-align: center; margin-top: 30px; color: #555; text-decoration: none; font-size: 12px; }
    </style>
</head>
<body>

    <div class="header">
        <h2 style="letter-spacing: 3px;">RANK STORE</h2>
        <span class="coin-display">YOUR COINS: <span id="userCoins">0</span> üíé</span>
    </div>

    <div class="rank-grid" id="rankGrid">
        </div>

    <a href="lobby.html" class="back-link">‚Üê BACK TO MISSION LOBBY</a>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, updateDoc, increment } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyBIT9JgQ8t044EbgeGSGWNfh-CgNrWajN8",
        authDomain: "hfc-academy.firebaseapp.com",
        projectId: "hfc-academy",
        storageBucket: "hfc-academy.firebasestorage.app",
        messagingSenderId: "84006497196",
        appId: "1:84006497196:web:be0d33ae2db19dd77ae809"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    const ranks = [
        { id: 'recruit', name: 'RECRUIT', price: 0 },
        { id: 'agent', name: 'FIELD AGENT', price: 50 },
        { id: 'specialist', name: 'SPECIALIST', price: 150 },
        { id: 'elite', name: 'ELITE OPERATIVE', price: 500 },
        { id: 'commander', name: 'COMMANDER', price: 1500 },
        { id: 'legend', name: 'HFC LEGEND', price: 5000 }
    ];

    let currentCoins = 0;
    let currentRank = 'recruit';

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            const snap = await getDoc(doc(db, "users", user.uid));
            if (snap.exists()) {
                currentCoins = snap.data().coins || 0;
                currentRank = snap.data().rank || 'recruit';
                document.getElementById('userCoins').innerText = currentCoins;
                renderRanks();
            }
        } else { window.location.href = "auth.html"; }
    });

    function renderRanks() {
        const grid = document.getElementById('rankGrid');
        grid.innerHTML = '';
        
        ranks.forEach(r => {
            const isOwned = currentRank === r.id;
            const canAfford = currentCoins >= r.price;
            
            grid.innerHTML += `
                <div class="rank-card">
                    <div class="rank-info">
                        <span class="rank-name">${r.name}</span>
                        <span class="rank-price">${r.price === 0 ? 'FREE' : r.price + ' COINS'}</span>
                    </div>
                    <button class="buy-btn ${isOwned ? 'owned' : ''}" 
                        onclick="purchaseRank('${r.id}', ${r.price})" 
                        ${isOwned || (r.price > 0 && !canAfford) ? 'disabled' : ''}>
                        ${isOwned ? 'ACTIVE' : 'BUY'}
                    </button>
                </div>
            `;
        });
    }

    window.purchaseRank = async (rankId, price) => {
        if (currentCoins < price) return alert("Not enough coins!");
        
        if (confirm(`Do you want to buy ${rankId.toUpperCase()} for ${price} coins?`)) {
            const userRef = doc(db, "users", auth.currentUser.uid);
            await updateDoc(userRef, {
                coins: increment(-price),
                rank: rankId
            });
            alert("Rank Upgraded!");
            location.reload();
        }
    };
</script>
</body>
</html>
